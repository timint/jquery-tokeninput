/*! jquery.tokeninput 2020-01-17 */

!function(H){var a={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",excludeCurrent:!1,excludeCurrentParameter:"x",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",animateDropdown:!0,placeholder:null,resultsLimit:null,enableHTML:!1,resultsFormatter:function(t){var e=t[this.propertyToSearch];return"<li>"+(this.enableHTML?e:K(e))+"</li>"},tokenFormatter:function(t){var e=t[this.propertyToSearch];return"<li><p>"+(this.enableHTML?e:K(e))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,allowTabOut:!1,autoSelectFirstResult:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,disabled:!1},_=8,q=9,M=13,z=27,B=37,N=38,$=39,G=40,Q=108,J=188,n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},s=/[&<>''\/]/g;function K(t){return(e=t,String(null==e?"":e)).replace(s,function(t){return n[t]});var e}var e={init:function(t,e){var n=H.extend({},a,e||{});return this.each(function(){H(this).data("settings",n),H(this).data("tokenInputObject",new H.TokenList(this,t,n))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(t){return this.data("tokenInputObject").add(t),this},remove:function(t){return this.data("tokenInputObject").remove(t),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(t){return this.data("tokenInputObject").toggleDisabled(t),this},setOptions:function(t){return H(this).data("settings",H.extend({},H(this).data("settings"),t||{})),this},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").clear();var t=this,e=this.parent();return e.empty(),t.show(),e.append(t),t}}};H.fn.tokenInput=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):e.init.apply(this,arguments)},H.TokenList=function(u,t,c){if("string"==typeof t||"function"==typeof t){H(u).data("settings").url=t;var e=A();void 0===H(u).data("settings").crossDomain&&"string"==typeof e&&(-1===e.indexOf("://")?H(u).data("settings").crossDomain=!1:H(u).data("settings").crossDomain=location.href.split(/\/+/g)[1]!==e.split(/\/+/g)[1])}else"object"==typeof t&&(H(u).data("settings").local_data=t);var n,s=[],i=0,g=new H.TokenList.Cache,p=H('<input type="text" autocomplete="off" autocapitalize="off" />').focus(function(){if(H(u).data("settings").disabled)return!1;null!==H(u).data("settings").tokenLimit&&H(u).data("settings").tokenLimit===i||H(u).data("settings").hintText&&(v.html("<p>"+k(H(u).data("settings").hintText)+"</p>"),R()),d.addClass(H(u).data("settings").classes.focused)}).blur(function(){j(),H(u).data("settings").allowFreeTagging&&y(),H(this).val(""),d.removeClass(H(u).data("settings").classes.focused)}).keydown(function(t){var e,n;switch(t.keyCode){case B:case $:case N:case G:if(0===this.value.length)e=h.prev(),n=h.next(),e.length&&e.get(0)===o||n.length&&n.get(0)===o?t.keyCode===B||t.keyCode===N?x(H(o),"before"):x(H(o),"after"):t.keyCode!==B&&t.keyCode!==N||!e.length?t.keyCode!==$&&t.keyCode!==G||!n.length||w(H(n.get(0))):w(H(e.get(0)));else{var a=null;t.keyCode===G||t.keyCode===$?(a=H(v).find("li").first(),r&&(a=H(r).next())):(a=H(v).find("li").last(),r&&(a=H(r).prev())),P(a)}break;case _:if(e=h.prev(),0===this.value.length)return o?(D(H(o)),f.change()):e.length&&w(H(e.get(0))),!1;1===H(this).val().length?j():setTimeout(function(){V()},5);break;case q:case M:case Q:case J:if(r)C(H(r).data("tokeninput")),f.change();else{if(H(u).data("settings").allowFreeTagging){if(H(u).data("settings").allowTabOut&&""===H(this).val())return!0;y()}else if(H(this).val(""),H(u).data("settings").allowTabOut)return!0;t.stopPropagation(),t.preventDefault()}return!1;case z:return j(),!0;default:String.fromCharCode(t.which)&&setTimeout(function(){V()},5)}});c.placeholder&&p.attr("placeholder",c.placeholder);var f=H(u).hide().val("").focus(function(){E(p)}).blur(function(){return p.blur(),f}),o=null,l=0,r=null,d=H('<ul class="form-control" />').addClass("token-input-list").click(function(t){var e=H(t.target).closest("li");e&&e.get(0)&&H.data(e.get(0),"tokeninput")?function(t){var e=o;o&&x(H(o),"end");e===t.get(0)?x(t,"end"):w(t)}(e):(o&&x(H(o),"end"),E(p))}).insertBefore(f),h=H('<li class="input" />').appendTo(d).append(p),v=H('<div class="token-input-dropdown dropdown" />').appendTo("body").hide();f.val("");var a=H(u).data("settings").prePopulate||f.data("pre");function k(t){return H(u).data("settings").enableHTML?t:K(t)}function m(t){H(u).data("settings").disabled="boolean"==typeof t?t:!H(u).data("settings").disabled,p.attr("disabled",H(u).data("settings").disabled),d.toggleClass(H(u).data("settings").classes.disabled,H(u).data("settings").disabled),o&&x(H(o),POSITION.END),f.attr("disabled",H(u).data("settings").disabled)}function T(){return null!==H(u).data("settings").tokenLimit&&i>=H(u).data("settings").tokenLimit&&(p.hide(),void j())}function y(){var t=H.trim(p.val()).split(H(u).data("settings").tokenDelimiter);H.each(t,function(t,e){if(e){H.isFunction(H(u).data("settings").onFreeTaggingAdd)&&(e=H(u).data("settings").onFreeTaggingAdd.call(f,e));var n={};n[H(u).data("settings").tokenValue]=n[H(u).data("settings").propertyToSearch]=e,C(n)}})}function b(t){var e=H(H(u).data("settings").tokenFormatter(t)),n=!0===t.readonly;n&&e.addClass(H(u).data("settings").classes.tokenReadOnly),e.addClass(H(u).data("settings").classes.token).insertBefore(h),n||H('<span class="delete">&times;</span>').appendTo(e).click(function(){if(!H(u).data("settings").disabled)return D(H(this).parent()),f.change(),!1});var a=t;return H.data(e.get(0),"tokeninput",t),s=s.slice(0,l).concat([a]).concat(s.slice(l)),l++,L(s,f),i+=1,null!==H(u).data("settings").tokenLimit&&i>=H(u).data("settings").tokenLimit&&(p.hide(),j()),e}function C(n){var t=H(u).data("settings").onAdd;if(0<i&&H(u).data("settings").preventDuplicates){var a=null;if(d.children().each(function(){var t=H(this),e=H.data(t.get(0),"tokeninput");if(e&&e[c.tokenValue]===n[c.tokenValue])return a=t,!1}),a)return w(a),h.insertAfter(a),void E(p)}p.width(1),(null==H(u).data("settings").tokenLimit||i<H(u).data("settings").tokenLimit)&&(b(n),p.attr("placeholder",null),T()),p.val(""),j(),H.isFunction(t)&&t.call(f,n)}function w(t){H(u).data("settings").disabled||(t.addClass(".active"),o=t.get(0),p.val(""),j())}function x(t,e){t.removeClass(H(u).data("settings").classes.selectedToken),o=null,"before"===e?(h.insertBefore(t),l--):"after"===e?(h.insertAfter(t),l++):(h.appendTo(d),l=i),E(p)}function D(t){var e=H.data(t.get(0),"tokeninput"),n=H(u).data("settings").onDelete,a=t.prevAll().length;l<a&&a--,t.remove(),o=null,E(p),0==(s=s.slice(0,a).concat(s.slice(a+1))).length&&p.attr("placeholder",c.placeholder),a<l&&l--,L(s,f),--i,null!==H(u).data("settings").tokenLimit&&(p.show().val(""),E(p)),H.isFunction(n)&&n.call(f,e)}function L(t,e){var n=H.map(t,function(t){return"function"==typeof H(u).data("settings").tokenValue?H(u).data("settings").tokenValue.call(this,t):t[H(u).data("settings").tokenValue]});e.val(n.join(H(u).data("settings").tokenDelimiter))}function j(){v.hide().empty(),r=null}function R(){v.css({position:"absolute",top:d.offset().top+d.outerHeight(!0),left:d.offset().left,width:d.width()}).show()}H(u).data("settings").processPrePopulate&&H.isFunction(H(u).data("settings").onResult)&&(a=H(u).data("settings").onResult.call(f,a)),a&&a.length&&H.each(a,function(t,e){b(e),T(),p.attr("placeholder",null)}),H(u).data("settings").disabled&&m(!0),"function"==typeof H(u).data("settings").onReady&&H(u).data("settings").onReady.call(),this.clear=function(){d.children("li").each(function(){0===H(this).children("input").length&&D(H(this))})},this.add=function(t){C(t)},this.remove=function(a){d.children("li").each(function(){if(0===H(this).children("input").length){var t=H(this).data("tokeninput"),e=!0;for(var n in a)if(a[n]!==t[n]){e=!1;break}e&&D(H(this))}})},this.getTokens=function(){return s},this.toggleDisabled=function(t){m(t)};var F=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g");function O(t){return t.replace(F,"\\$&")}function I(t,e,n){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+O(e)+")(?![^<>]*>)(?![^&;]+;)","g"),(a=n,e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+O(a)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(t,e){return"<b>"+k(e)+"</b>"})));var a}function S(a,t){if((t=function(t){if(H(u).data("settings").excludeCurrent){var e=H(u).data("tokenInputObject").getTokens(),s=[];e.length&&(H.each(t,function(t,n){var a=!0;H.each(e,function(t,e){if(n[H(u).data("settings").propertyToSearch]==e[H(u).data("settings").propertyToSearch])return a=!1}),a&&s.push(n)}),t=s)}return t}(t))&&t.length){v.empty();var s=H("<ul/>").appendTo(v).mouseover(function(t){P(H(t.target).closest("li"))}).mousedown(function(t){return C(H(t.target).closest("li").data("tokeninput")),f.change(),!1}).hide();H(u).data("settings").resultsLimit&&t.length>H(u).data("settings").resultsLimit&&(t=t.slice(0,H(u).data("settings").resultsLimit)),H.each(t,function(t,e){var n=H(u).data("settings").resultsFormatter(e);n=I(n,e[H(u).data("settings").propertyToSearch],a),n=H(n).appendTo(s),t%2?n.addClass(H(u).data("settings").classes.dropdownItem):n.addClass(H(u).data("settings").classes.dropdownItem2),0===t&&H(u).data("settings").autoSelectFirstResult&&P(n),H.data(n.get(0),"tokeninput",e)}),R(),H(u).data("settings").animateDropdown?s.slideDown("fast"):s.show()}else H(u).data("settings").noResultsText&&(v.html("<p>"+k(H(u).data("settings").noResultsText)+"</p>"),R())}function P(t){t&&(r&&(H(r).removeClass(H(u).data("settings").classes.selectedDropdownItem),r=null),t.addClass(H(u).data("settings").classes.selectedDropdownItem),r=t.get(0))}function V(){var t=p.val();t&&t.length&&(o&&x(H(o),"after"),t.length>=H(u).data("settings").minChars?(H(u).data("settings").searchingText&&(v.html("<p>"+k(H(u).data("settings").searchingText)+"</p>"),R()),clearTimeout(n),n=setTimeout(function(){!function(e){var n=e+A(),t=g.get(n);if(t)H.isFunction(H(u).data("settings").onCachedResult)&&(t=H(u).data("settings").onCachedResult.call(f,t)),S(e,t);else if(H(u).data("settings").url){var a=A(),s={data:{}};if(-1<a.indexOf("?")){var i=a.split("?");s.url=i[0];var o=i[1].split("&");H.each(o,function(t,e){var n=e.split("=");s.data[n[0]]=n[1]})}else s.url=a;if(s.data[H(u).data("settings").queryParam]=e,s.type=H(u).data("settings").method,s.dataType=H(u).data("settings").contentType,H(u).data("settings").crossDomain&&(s.dataType="jsonp"),H(u).data("settings").excludeCurrent){var l=H(u).data("tokenInputObject").getTokens(),r=H.map(l,function(t){return"function"==typeof H(u).data("settings").tokenValue?H(u).data("settings").tokenValue.call(this,t):t[H(u).data("settings").tokenValue]});s.data[H(u).data("settings").excludeCurrentParameter]=r.join(H(u).data("settings").tokenDelimiter)}s.success=function(t){g.add(n,H(u).data("settings").jsonContainer?t[H(u).data("settings").jsonContainer]:t),H.isFunction(H(u).data("settings").onResult)&&(t=H(u).data("settings").onResult.call(f,t)),p.val()===e&&S(e,H(u).data("settings").jsonContainer?t[H(u).data("settings").jsonContainer]:t)},c.onSend&&c.onSend(s),H.ajax(s)}else if(H(u).data("settings").local_data){var d=H.grep(H(u).data("settings").local_data,function(t){return-1<t[H(u).data("settings").propertyToSearch].toLowerCase().indexOf(e.toLowerCase())});g.add(n,d),H.isFunction(H(u).data("settings").onResult)&&(d=H(u).data("settings").onResult.call(f,d)),S(e,d)}}(t)},H(u).data("settings").searchDelay)):j())}function A(){var t=H(u).data("settings");return"function"==typeof t.url?t.url.call(t):t.url}function E(t){setTimeout(function(){t.focus()},50)}},H.TokenList.Cache=function(t){var n,a,s={},i=0;n=H.extend({max_size:500},t),a=function(){s={},i=0},this.add=function(t,e){i>n.max_size&&a(),s[t]||(i+=1),s[t]=e},this.get=function(t){return s[t]}}}(jQuery);